; PlatformIO Project Configuration (cleaned)
; Centralized common settings under [env] and a single explicit env for
; the development board used in this project. Keep this file minimal and
; explicit to make builds reproducible.

[platformio]
default_envs = az-delivery-devkit-v4

[env]
monitor_speed = 115200

; Optimize incremental builds
lib_ldf_mode = chain
lib_compat_mode = strict

; Common library dependencies
lib_deps =
    SignalK/SensESP@^3.1.1


; Common build flags (applied to all envs unless overridden)
build_flags =
    -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_VERBOSE
    -D USE_ESP_IDF_LOG
    -Wno-deprecated-declarations
    -std=gnu++17

; Avoid treating reorder warnings as errors and enable the ESP32 exception decoder
build_unflags =
    -Werror=reorder
monitor_filters = esp32_exception_decoder

board_build.partitions = min_spiffs.csv

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Test environment (runs tests on connected ESP32 hardware)
; Note: Tests require connected ESP32 hardware to execute
; Connect ESP32 via USB and run: platformio test -e test
[env:test]
platform = espressif32@^6.9.0
framework = arduino
board = az-delivery-devkit-v4
test_port = COM3
test_build_src = no

lib_deps =
    ${env.lib_deps}

build_flags =
    ${env.build_flags}
    -D TAG='"Arduino"'
    -Wno-deprecated-declarations

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Environment for MH ET LIVE ESP32MiniKit
[env:mhetesp32minikit]
platform = espressif32@^6.9.0
framework = arduino
board = mhetesp32minikit
upload_protocol = esptool

; Reuse the common lib_deps and build_flags (explicit duplication avoided)
lib_deps =
    ${env.lib_deps}

build_flags =
    ${env.build_flags}
    -D TAG='"Arduino"'
    -Wno-deprecated-declarations

; If you need platform-specific dependencies (e.g. esp_websocket_client for
; ESP-IDF), add a separate env instead of bloating the general env.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Environment for AZ-Delivery ESP-32 Dev Kit C V4
[env:az-delivery-devkit-v4]
platform = espressif32@^6.9.0
framework = arduino
board = az-delivery-devkit-v4
upload_protocol = esptool
board_build.flash_mode = dio
board_build.f_flash = 40000000L
board_build.f_cpu = 240000000L

; Reuse the common lib_deps and build_flags (explicit duplication avoided)
lib_deps =
    ${env.lib_deps}

build_flags =
    ${env.build_flags}
    -D TAG='"Arduino"'
    -Wno-deprecated-declarations

